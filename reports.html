<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reports - PureLife Family Care</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Noto+Nastaliq+Urdu:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <div class="logo-icon">
                    <img src="images/logo.png" alt="PureLife">
                </div>
                <div class="logo-text">
                    <h1>PureLife</h1>
                    <span>Order Management</span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-section">
                    <div class="nav-section-title">Main Menu</div>
                    <a href="dashboard.html" class="nav-item">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                    <a href="status-dashboard.html" class="nav-item">
                        <i class="fas fa-chart-pie"></i>
                        <span>Status Dashboard</span>
                    </a>
                    <a href="booking.html" class="nav-item">
                        <i class="fas fa-plus-circle"></i>
                        <span>New Booking</span>
                    </a>
                    <a href="orders.html" class="nav-item">
                        <i class="fas fa-box-open"></i>
                        <span>Orders</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Management</div>
                    <a href="products.html" class="nav-item">
                        <i class="fas fa-tags"></i>
                        <span>Products</span>
                    </a>
                    <a href="customers.html" class="nav-item">
                        <i class="fas fa-users"></i>
                        <span>Customers</span>
                    </a>
                    <a href="reports.html" class="nav-item active">
                        <i class="fas fa-chart-bar"></i>
                        <span>Reports</span>
                    </a>
                </div>
                
                <div class="nav-section">
                    <div class="nav-section-title">Settings</div>
                    <a href="settings.html" class="nav-item">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </a>
                </div>
            </nav>
            
            <div class="sidebar-footer">
                <div class="user-card" onclick="Auth.logout()">
                    <div class="user-avatar">LA</div>
                    <div class="user-info">
                        <h4>Liaqat Ali</h4>
                        <span>Admin</span>
                    </div>
                    <i class="fas fa-sign-out-alt logout-icon"></i>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="menu-toggle" onclick="toggleSidebar()" title="Toggle Menu" aria-label="Toggle Menu">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="page-title">
                        <h2>Reports</h2>
                        <span>Analytics and insights for your business</span>
                    </div>
                </div>
                
                <div class="header-right">
                    <select class="form-control" style="width: 150px;" id="reportPeriod" onchange="updateReport()">
                        <option value="7">Last 7 Days</option>
                        <option value="30" selected>Last 30 Days</option>
                        <option value="90">Last 90 Days</option>
                        <option value="365">This Year</option>
                    </select>
                    <button class="btn btn-primary" onclick="downloadReport()">
                        <i class="fas fa-download"></i> Export PDF
                    </button>
                </div>
            </header>
            
            <!-- Content -->
            <div class="content">
                <!-- Overview Stats -->
                <div class="stats-grid">
                    <div class="stat-card primary animate-slideUp">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-coins"></i></div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i> 15%
                            </div>
                        </div>
                        <div class="stat-value" id="reportRevenue">Rs. 0</div>
                        <div class="stat-label">Total Revenue</div>
                    </div>
                    
                    <div class="stat-card secondary animate-slideUp" style="animation-delay: 0.1s">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-shopping-cart"></i></div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i> 12%
                            </div>
                        </div>
                        <div class="stat-value" id="reportOrders">0</div>
                        <div class="stat-label">Total Orders</div>
                    </div>
                    
                    <div class="stat-card warning animate-slideUp" style="animation-delay: 0.2s">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                            <div class="stat-trend up">
                                <i class="fas fa-arrow-up"></i> 8%
                            </div>
                        </div>
                        <div class="stat-value" id="avgOrder">Rs. 0</div>
                        <div class="stat-label">Average Order Value</div>
                    </div>
                    
                    <div class="stat-card danger animate-slideUp" style="animation-delay: 0.3s">
                        <div class="stat-header">
                            <div class="stat-icon"><i class="fas fa-percentage"></i></div>
                        </div>
                        <div class="stat-value" id="successRate">98%</div>
                        <div class="stat-label">Delivery Success Rate</div>
                    </div>
                </div>
                
                <!-- Charts Row -->
                <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 24px;">
                    <!-- Sales Chart -->
                    <div class="card animate-slideUp" style="animation-delay: 0.4s">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-chart-area"></i>
                                Sales Overview
                            </h3>
                        </div>
                        <div class="card-body">
                            <div id="salesChart" style="height: 300px; display: flex; align-items: flex-end; gap: 8px; padding: 20px 0;">
                                <!-- Chart bars will be rendered here -->
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 0 10px; margin-top: 10px;">
                                <span style="font-size: 11px; color: var(--gray-500);">Week 1</span>
                                <span style="font-size: 11px; color: var(--gray-500);">Week 2</span>
                                <span style="font-size: 11px; color: var(--gray-500);">Week 3</span>
                                <span style="font-size: 11px; color: var(--gray-500);">Week 4</span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Top Products -->
                    <div class="card animate-slideUp" style="animation-delay: 0.5s">
                        <div class="card-header">
                            <h3 class="card-title">
                                <i class="fas fa-trophy"></i>
                                Top Products
                            </h3>
                        </div>
                        <div class="card-body" id="topProducts">
                            <!-- Products will be rendered here -->
                        </div>
                    </div>
                </div>
                
                <!-- Courier Performance -->
                <div class="card animate-slideUp" style="animation-delay: 0.6s">
                    <div class="card-header">
                        <h3 class="card-title">
                            <i class="fas fa-truck"></i>
                            Courier Performance
                        </h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                            <!-- Post Office -->
                            <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #667eea, #764ba2); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-mail-bulk" style="color: white; font-size: 20px;"></i>
                                    </div>
                                    <div>
                                        <h4 style="font-size: 16px; font-weight: 600; color: var(--dark);">Post Office (VPL)</h4>
                                        <span style="font-size: 13px; color: var(--gray-500);">Most used courier</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="poOrders">0</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Orders</div>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--secondary);">98%</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Success</div>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--accent-orange);">3.2</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Avg Days</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- TCS -->
                            <div style="background: var(--gray-50); border-radius: 12px; padding: 20px;">
                                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 15px;">
                                    <div style="width: 50px; height: 50px; background: linear-gradient(135deg, #f59e0b, #fbbf24); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                                        <i class="fas fa-shipping-fast" style="color: white; font-size: 20px;"></i>
                                    </div>
                                    <div>
                                        <h4 style="font-size: 16px; font-weight: 600; color: var(--dark);">TCS</h4>
                                        <span style="font-size: 13px; color: var(--gray-500);">Express delivery</span>
                                    </div>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; text-align: center;">
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--primary);" id="tcsOrders">0</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Orders</div>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--secondary);">99%</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Success</div>
                                    </div>
                                    <div style="background: white; padding: 12px; border-radius: 8px;">
                                        <div style="font-size: 20px; font-weight: 700; color: var(--accent-orange);">1.5</div>
                                        <div style="font-size: 11px; color: var(--gray-500);">Avg Days</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <div id="toastContainer" class="toast-container"></div>
    
    <script src="js/app.js"></script>
    <script>
        // Check auth
        if (!Auth.isLoggedIn()) {
            window.location.href = 'index.html';
        }
        
        document.addEventListener('DOMContentLoaded', async () => {
            const orders = await DataService.fetchOrders();
            updateReportData(orders);
        });
        
        function updateReportData(orders) {
            // Stats
            const total = orders.reduce((sum, o) => sum + o.price, 0);
            document.getElementById('reportRevenue').textContent = UI.formatCurrency(total);
            document.getElementById('reportOrders').textContent = orders.length;
            document.getElementById('avgOrder').textContent = UI.formatCurrency(orders.length > 0 ? Math.round(total / orders.length) : 0);
            
            // Courier stats
            const poOrders = orders.filter(o => (o.courier || '').toLowerCase().includes('post'));
            const tcsOrders = orders.filter(o => (o.courier || '').toLowerCase().includes('tcs'));
            document.getElementById('poOrders').textContent = poOrders.length;
            document.getElementById('tcsOrders').textContent = tcsOrders.length;
            
            // Render chart
            renderSalesChart(orders);
            
            // Top products
            renderTopProducts(orders);
        }
        
        function renderSalesChart(orders) {
            const container = document.getElementById('salesChart');
            
            // Group by week (simple simulation)
            const weeks = [0, 0, 0, 0];
            orders.forEach((o, i) => {
                const weekIndex = i % 4;
                weeks[weekIndex] += o.price;
            });
            
            const max = Math.max(...weeks, 1);
            
            container.innerHTML = weeks.map((value, i) => {
                const height = (value / max) * 250;
                const colors = [
                    'linear-gradient(180deg, #667eea, #764ba2)',
                    'linear-gradient(180deg, #11998e, #38ef7d)',
                    'linear-gradient(180deg, #f59e0b, #fbbf24)',
                    'linear-gradient(180deg, #ec4899, #f43f5e)'
                ];
                return `
                    <div style="flex: 1; display: flex; flex-direction: column; align-items: center; gap: 8px;">
                        <div style="font-size: 12px; font-weight: 600; color: var(--dark);">${UI.formatCurrency(value)}</div>
                        <div style="width: 100%; max-width: 60px; height: ${height}px; background: ${colors[i]}; border-radius: 8px 8px 0 0; transition: 0.5s;"></div>
                    </div>
                `;
            }).join('');
        }
        
        function renderTopProducts(orders) {
            const container = document.getElementById('topProducts');
            
            // Group by product
            const products = {};
            orders.forEach(o => {
                const name = o.product || 'Unknown';
                if (!products[name]) products[name] = { count: 0, revenue: 0 };
                products[name].count++;
                products[name].revenue += o.price;
            });
            
            const sorted = Object.entries(products)
                .sort((a, b) => b[1].count - a[1].count)
                .slice(0, 5);
            
            if (sorted.length === 0) {
                container.innerHTML = `<p style="text-align: center; color: var(--gray-500);">No product data</p>`;
                return;
            }
            
            container.innerHTML = sorted.map(([name, data], i) => `
                <div style="display: flex; align-items: center; gap: 12px; padding: 12px 0; ${i < sorted.length - 1 ? 'border-bottom: 1px solid var(--gray-200);' : ''}">
                    <div style="width: 32px; height: 32px; background: var(--primary-50); color: var(--primary); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-weight: 700; font-size: 14px;">
                        ${i + 1}
                    </div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: var(--dark); font-size: 14px;">${name}</div>
                        <div style="font-size: 12px; color: var(--gray-500);">${data.count} orders</div>
                    </div>
                    <div style="font-weight: 700; color: var(--secondary);">${UI.formatCurrency(data.revenue)}</div>
                </div>
            `).join('');
        }
        
        function updateReport() {
            UI.showToast('Report period updated!', 'success');
        }
        
        function downloadReport() {
            UI.showToast('Report download feature coming soon!', 'info');
        }
    </script>
</body>
</html>
